import parseGame, { checkBoard } from "../parse-game";
import { setFailed } from "@actions/core";

jest.mock("@actions/core");

describe("parseGame", () => {
  test("works", () => {
    expect(
      parseGame(
        "Wordle 210 3/6",
        `ğŸŸ©â¬›â¬›â¬›â¬›
â¬›â¬›ğŸŸ¨ğŸŸ©ğŸŸ¨
ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©`
      )
    ).toEqual({
      board: ["ğŸŸ©â¬›â¬›â¬›â¬›", "â¬›â¬›ğŸŸ¨ğŸŸ©ğŸŸ¨", "ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©"],
      gameNumber: 210,
      score: 3,
      won: true,
    });
    expect(
      parseGame(
        "Wordle 208 X/6",
        `â¬›â¬›â¬›â¬›ğŸŸ¨
â¬›ğŸŸ¨â¬›â¬›â¬›
â¬›ğŸŸ¨â¬›ğŸŸ©â¬›
ğŸŸ©â¬›â¬›â¬›ğŸŸ¨
ğŸŸ©â¬›â¬›ğŸŸ©â¬›
ğŸŸ©â¬›â¬›ğŸŸ©â¬›`
      )
    ).toEqual({
      board: [
        "â¬›â¬›â¬›â¬›ğŸŸ¨",
        "â¬›ğŸŸ¨â¬›â¬›â¬›",
        "â¬›ğŸŸ¨â¬›ğŸŸ©â¬›",
        "ğŸŸ©â¬›â¬›â¬›ğŸŸ¨",
        "ğŸŸ©â¬›â¬›ğŸŸ©â¬›",
        "ğŸŸ©â¬›â¬›ğŸŸ©â¬›",
      ],
      gameNumber: 208,
      score: "X",
      won: false,
    });
    expect(
      parseGame(
        "Wordle 209 6/6",
        `Wordle 209 6/6

ğŸŸ©â¬›ğŸŸ¨â¬›ğŸŸ¨
ğŸŸ©ğŸŸ©â¬›â¬›â¬›
ğŸŸ©ğŸŸ©â¬›â¬›â¬›
ğŸŸ©â¬›ğŸŸ©â¬›â¬›
ğŸŸ©ğŸŸ©ğŸŸ©â¬›â¬›
ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©
`
      )
    ).toEqual({
      board: [
        "ğŸŸ©â¬›ğŸŸ¨â¬›ğŸŸ¨",
        "ğŸŸ©ğŸŸ©â¬›â¬›â¬›",
        "ğŸŸ©ğŸŸ©â¬›â¬›â¬›",
        "ğŸŸ©â¬›ğŸŸ©â¬›â¬›",
        "ğŸŸ©ğŸŸ©ğŸŸ©â¬›â¬›",
        "ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©",
      ],
      gameNumber: 209,
      score: 6,
      won: true,
    });
  });
});

describe("checkBoard", () => {
  test("works", () => {
    expect(
      checkBoard(`ğŸŸ©â¬›â¬›â¬›â¬›
â¬›â¬›ğŸŸ¨ğŸŸ©ğŸŸ¨
ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©`)
    ).toEqual(["ğŸŸ©â¬›â¬›â¬›â¬›", "â¬›â¬›ğŸŸ¨ğŸŸ©ğŸŸ¨", "ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©"]);
  });
  test("error, no value", () => {
    checkBoard(``);
    expect(setFailed).toHaveBeenCalledWith("Wordle board is invalid: []");
  });
  test("error, too many rows", () => {
    checkBoard(`ğŸŸ©â¬›â¬›â¬›â¬›
ğŸŸ©â¬›â¬›â¬›â¬›
ğŸŸ©â¬›â¬›â¬›â¬›
ğŸŸ©â¬›â¬›â¬›â¬›
ğŸŸ©â¬›â¬›â¬›â¬›
â¬›â¬›ğŸŸ¨ğŸŸ©ğŸŸ¨
ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©`);
    expect(setFailed).toHaveBeenCalledWith(
      'Wordle board is invalid: ["ğŸŸ©â¬›â¬›â¬›â¬›","ğŸŸ©â¬›â¬›â¬›â¬›","ğŸŸ©â¬›â¬›â¬›â¬›","ğŸŸ©â¬›â¬›â¬›â¬›","ğŸŸ©â¬›â¬›â¬›â¬›","â¬›â¬›ğŸŸ¨ğŸŸ©ğŸŸ¨","ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ©"]'
    );
  });
});
